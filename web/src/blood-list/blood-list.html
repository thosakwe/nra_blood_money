<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/iron-icons/communication-icons.html">
<link rel="import" href="../../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../../bower_components/iron-image/iron-image.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-dialog-scrollable/paper-dialog-scrollable.html">
<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-item-body.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tab.html">
<link rel="import" href="../../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">

<dom-module id="blood-list">
    <template>
        <style>
            :host {
                @apply(--layout);
                @apply(--layout-fullbleed);
                @apply(--layout-vertical);
            }

            #drawer-header {
                background-size: cover;
            }

            iron-list {
                margin-top: 1em;
            }

            paper-drawer-panel, paper-scroll-header-panel, paper-header-panel, paper-listbox {
                @apply(--layout-flex);
                background-color: transparent;
            }

            paper-fab {
                position: fixed;
                bottom: 1em;
                right: 1em;
            }

            paper-icon-item {
                color: var(--primary-text-color);
            }

            paper-scroll-header-panel paper-toolbar {
                box-shadow: 0 5px 6px -3px rgba(0, 0, 0, 0.4);
            }

            .avatar img {
                border-radius: 50%;
                height: 2.5em;
                margin-right: 1em;
            }

            .divider {
                border-bottom: 1px solid var(--divider-color);
            }
        </style>

        <paper-drawer-panel id="drawer" force-narrow right-drawer>
            <paper-header-panel mode="seamed" slot="drawer">
                <paper-toolbar id="drawer-header" class="tall" style$="[[__computeDrawerHeaderStyle(s)]]">
                    <div class="title" slot="bottom" style="margin-left: 0;">[[s.name]]</div>
                    <paper-icon-button icon="star-border" slot="bottom">
                        <!-- TODO: Create a list of "favorites" -->
                    </paper-icon-button>
                </paper-toolbar>
                <div>
                    <paper-listbox>
                        <paper-item disabled>
                            <paper-item-body two-line>
                                <div style="color: var(--primary-text-color);">About</div>
                                <div secondary>[[s.bio]]</div>
                            </paper-item-body>
                        </paper-item>

                        <div class="divider"></div>

                        <paper-icon-item>
                            <iron-icon icon="editor:attach-money" slot="item-icon"></iron-icon>
                            <!-- TODO: Format this -->
                            [[s.money_from_nra]]
                        </paper-icon-item>

                        <paper-icon-item>
                            <iron-icon icon="social:public" slot="item-icon"></iron-icon>
                            Website
                        </paper-icon-item>
                        <paper-icon-item>
                            <iron-icon icon="communication:phone" slot="item-icon"></iron-icon>
                            Call
                        </paper-icon-item>
                        <paper-icon-item>
                            <iron-icon icon="mail" slot="item-icon"></iron-icon>
                            Email
                        </paper-icon-item>
                    </paper-listbox>
                </div>
            </paper-header-panel>

            <paper-scroll-header-panel slot="main" condenses>
                <paper-toolbar class="medium-tall" slot="header">
                    <paper-icon-button icon="chevron-left" slot="top"></paper-icon-button>
                    <div class="title" slot="top">
                        NRA-Friendly Politicians
                    </div>
                    <paper-icon-button icon="search" slot="top"></paper-icon-button>
                    <paper-tabs class="fit" slot="bottom" selected="{{tab}}">
                        <paper-tab>ALL</paper-tab>
                        <paper-tab>SENATE</paper-tab>
                        <paper-tab>HOUSE</paper-tab>
                        <paper-tab>OTHER</paper-tab>
                    </paper-tabs>
                </paper-toolbar>

                <div>
                    <!-- TODO: Empty state -->
                    <paper-listbox id="list" slot="content">
                        <template id="listRepeat" is="dom-repeat" items="[[politicians]]" as="p" filter="__filter">
                            <paper-icon-item on-tap="__selectItem">
                                <div class="avatar" slot="item-icon">
                                    <img src$="[[p.image_url]]" alt$="[[p.name]]">
                                </div>
                                <paper-item-body two-line>
                                    <div>[[p.name]]</div>
                                    <div secondary>
                                        <span style="font-weight: bold;">[[p.position]]</span> @ [[p.state]]
                                    </div>
                                </paper-item-body>
                                <paper-icon-button icon="star-border"></paper-icon-button>
                            </paper-icon-item>
                        </template>
                    </paper-listbox>

                    <paper-fab icon="add"></paper-fab>
                </div>
            </paper-scroll-header-panel>
        </paper-drawer-panel>
    </template>

    <script>
      /**
       * @customElement
       * @polymer
       */
      class BloodList extends Polymer.Element {
        static get is() {
          return 'blood-list';
        }

        static get properties() {
          return {
            tab: {
              type: Number,
              value: 0
            }
          };
        }

        static get observers() {
          return [
            '__tabChanged(tab)'
          ];
        }

        __computeDrawerHeaderStyle(s) {
          if (s) {
            return `background-image: url('${s.image_url}');`;
          }
        }

        __filter(p) {
          switch (this.tab) {
            case 1:
              return p.position === 'Senator';
            case 2:
              return p.position === 'Representative';
            case 3:
              return p.position !== 'Senator' && p.position !== 'Representative';
            default:
              return true;
          }
        }

        __selectItem(e) {
          this.s = e.model.p;
          this.$.drawer.togglePanel();
        }

        __tabChanged(tab) {
          this.$.listRepeat.render();
        }
      }

      window.customElements.define(BloodList.is, BloodList);
    </script>
</dom-module>